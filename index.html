// x5BinanceAlphaBOTv1.3

let value = 70;          // æ¯æ¬¡è²·å…¥é‡‘é¡
let runtime = 10;       // åŸ·è¡Œæ¬¡æ•¸
let customize = 0.1;    // è‡ªè¨‚æ»‘é»žè¨­å®š

// æ¯ä¸€æ­¥é©Ÿçš„éš¨æ©Ÿå»¶é²ç¯„åœï¼ˆæ¯«ç§’ï¼‰ï¼š[min, max]
const stepDelay = {
  é»žæ“Šè²·å…¥tab: [3000, 3500],
  è¨­å®šé‡‘é¡: [2500, 3000],
  è¨­å®šæ»‘é»ž: [1500, 1500],
  é»žæ“Šè²·å…¥: [2000, 3000],
  ç¢ºèªè²·å…¥: [1500, 2000],
  é»žæ“Šå‡ºå”®tab: [3000, 3500],
  æ»‘æ¡¿100: [2500, 2700],
  è¨­å®šæ»‘é»ž_è³£: [1500, 1500],
  é»žæ“Šå‡ºå”®: [2000, 3000],
  ç¢ºèªå‡ºå”®: [1500, 2000],
};

// éš¨æ©Ÿå»¶é²å‡½æ•¸
const randomDelay = ([min, max]) => {
  const ms = Math.floor(Math.random() * (max - min + 1)) + min;
  console.log(`[x5BOT] ç­‰å¾… ${ms}ms...`);
  return new Promise(resolve => setTimeout(resolve, ms));
};

// æ¨¡æ“¬é»žæ“ŠæŒ‰éˆ•
const simulateClick = (element, label = 'æŒ‰éˆ•') => {
  if (!element) return console.error(`[éŒ¯èª¤] æ‰¾ä¸åˆ° ${label}`);
  element.dispatchEvent(new MouseEvent('click', { bubbles: true }));
  console.log(`[x5BOT] âœ… é»žæ“Š ${label}`);
  return true;
};

// è¨­å®šè¼¸å…¥å€¼ï¼ˆå…¼å®¹ Reactï¼‰
const setInputValue = (el, val) => {
  if (!el) return console.error(`[éŒ¯èª¤] æ‰¾ä¸åˆ°è¼¸å…¥æ¡†`);
  const nativeSetter = Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype, 'value').set;
  nativeSetter.call(el, val);
  el.dispatchEvent(new Event('input', { bubbles: true }));
  console.log(`[x5BOT] âœ… è¨­å®šè¼¸å…¥å€¼: ${val}`);
  return true;
};

// é»žæ“ŠåŒ…å«æŒ‡å®šæ–‡å­—çš„æŒ‰éˆ•
const clickButtonByText = (text) => {
  const btns = [...document.querySelectorAll('button')];
  const target = btns.find(b => b.innerText.includes(text));
  return simulateClick(target, `æŒ‰éˆ•ï¼ˆ${text}ï¼‰`);
};

// é»žé¸ tabï¼ˆè²·å…¥/è³£å‡ºï¼‰
const clickTab = (text) => {
  const tabs = [...document.querySelectorAll('[role="tab"]')];
  const tab = tabs.find(t => t.innerText.includes(text));
  return simulateClick(tab, `Tabï¼ˆ${text}ï¼‰`);
};

// é»žæ“Šæ»‘é»žè¨­å®šçš„ã€Œè‡ªå®šç¾©ã€ä¸¦è¼¸å…¥
const setSlippage = async () => {
  const divs = [...document.querySelectorAll('div')];
  const trigger = divs.find(d => d.innerText.includes('æ»‘é»ž') && d.className.includes('cursor-pointer'));
  simulateClick(trigger, 'æ»‘é»žè¨­å®šé–‹å•Ÿ');
  await randomDelay([500, 1000]);

  const option = divs.find(d => d.innerText.includes('è‡ªå®šç¾©'));
  simulateClick(option, 'æ»‘é»žé¸å–®ï¼šè‡ªå®šç¾©');
  await randomDelay([500, 1000]);

  const input = document.querySelector('#customize-slippage');
  if (!setInputValue(input, customize)) {
    console.warn('[è­¦å‘Š] ç„¡æ³•è¨­å®šæ»‘é»ž');
  }

  await randomDelay([500, 1000]);
  clickButtonByText('ç¢ºèª');
};

// å–®è¼ªäº¤æ˜“åŸ·è¡Œ
const runOneTrade = async (round) => {
  console.log(`\nðŸŽ¯ [x5BOT] ðŸš€ é–‹å§‹ç¬¬ ${round} ç­†äº¤æ˜“`);

  clickTab('è²·å…¥');
  await randomDelay(stepDelay['é»žæ“Šè²·å…¥tab']);

  const input = document.querySelector('#fromCoinAmount');
  setInputValue(input, value);
  await randomDelay(stepDelay['è¨­å®šé‡‘é¡']);

  await setSlippage();
  await randomDelay(stepDelay['è¨­å®šæ»‘é»ž']);

  clickButtonByText('è²·å…¥');
  await randomDelay(stepDelay['é»žæ“Šè²·å…¥']);

  clickButtonByText('ç¢ºèª');
  await randomDelay(stepDelay['ç¢ºèªè²·å…¥']);

  clickTab('å‡ºå”®');
  await randomDelay(stepDelay['é»žæ“Šå‡ºå”®tab']);

  const slider = document.querySelector('input[role="slider"]');
  setInputValue(slider, '100');
  await randomDelay(stepDelay['æ»‘æ¡¿100']);

  await setSlippage();
  await randomDelay(stepDelay['è¨­å®šæ»‘é»ž_è³£']);

  clickButtonByText('å‡ºå”®');
  await randomDelay(stepDelay['é»žæ“Šå‡ºå”®']);

  clickButtonByText('ç¢ºèª');
  console.log(`âœ… [x5BOT] ç¬¬ ${round} ç­†äº¤æ˜“å®Œæˆ ðŸŽ‰`);
  await randomDelay(stepDelay['ç¢ºèªå‡ºå”®']);
};

// ä¸»äº¤æ˜“è¿´åœˆ
const runTradeLoop = async () => {
  for (let i = 1; i <= runtime; i++) {
    try {
      await runOneTrade(i);
    } catch (e) {
      console.error(`[éŒ¯èª¤] ç¬¬ ${i} ç­†äº¤æ˜“å¤±æ•—ï¼š${e.message}`);
    }
  }
  console.log('\nè‘£äº‹é•·æ‚¨å©å’çš„äº‹æƒ…å·²ç¶“å®Œæˆäº†!');
};

runTradeLoop();
